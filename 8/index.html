<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Earth from Space â€” HDRI Galaxy</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body{margin:0;height:100%;background:#000;overflow:hidden}
    canvas{display:block}
  </style>
</head>
<body>
  <!-- Three.js + OrbitControls -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>

  <script>
  // ===== Scene, Camera, Renderer =====
  const scene   = new THREE.Scene();
  const camera  = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 5000);
  camera.position.set(0, 0, 15);

  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  const controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.minDistance = 7;
  controls.maxDistance = 30;

  // ===== Galaxy / Nebula HDRI (CubeTexture) =====
  // Pakai cube map Milky Way bawaan three.js examples (CORS-ready)
  const cubeLoader = new THREE.CubeTextureLoader();
  const galaxy = cubeLoader.load([
    "https://threejs.org/examples/textures/cube/MilkyWay/dark-s_px.jpg",
    "https://threejs.org/examples/textures/cube/MilkyWay/dark-s_nx.jpg",
    "https://threejs.org/examples/textures/cube/MilkyWay/dark-s_py.jpg",
    "https://threejs.org/examples/textures/cube/MilkyWay/dark-s_ny.jpg",
    "https://threejs.org/examples/textures/cube/MilkyWay/dark-s_pz.jpg",
    "https://threejs.org/examples/textures/cube/MilkyWay/dark-s_nz.jpg",
  ]);
  scene.background = galaxy;

  // ===== Lights (Sun + Ambient) =====
  const sunLight = new THREE.DirectionalLight(0xffffff, 2.0);
  sunLight.position.set(100, 0, 50); // arah sinar matahari
  scene.add(sunLight);

  const ambient = new THREE.AmbientLight(0x1a1a1a, 1.0);
  scene.add(ambient);

  // ===== Textures (8K Earth) =====
  const loader = new THREE.TextureLoader();
  const tDay   = loader.load("https://raw.githubusercontent.com/rajatpillai/earth-textures/main/8k_earth_daymap.jpg");
  const tNight = loader.load("https://raw.githubusercontent.com/rajatpillai/earth-textures/main/8k_earth_nightmap.jpg");
  const tNorm  = loader.load("https://raw.githubusercontent.com/rajatpillai/earth-textures/main/8k_earth_normal_map.jpg");
  const tSpec  = loader.load("https://raw.githubusercontent.com/rajatpillai/earth-textures/main/8k_earth_specular_map.jpg");
  const tCloud = loader.load("https://raw.githubusercontent.com/rajatpillai/earth-textures/main/8k_earth_clouds.jpg");

  // Anisotropy kecil buat tajam
  [tDay,tNight,tNorm,tSpec,tCloud].forEach(tex=>{
    tex.anisotropy = Math.min(renderer.capabilities.getMaxAnisotropy(), 8);
  });

  // ===== Earth (day) =====
  const gEarth = new THREE.SphereGeometry(5, 128, 128);
  const mEarth = new THREE.MeshPhongMaterial({
    map: tDay,
    bumpMap: tNorm,
    bumpScale: 0.15,
    specularMap: tSpec,
    specular: new THREE.Color(0x666666),
    shininess: 15
  });
  const earth = new THREE.Mesh(gEarth, mEarth);
  scene.add(earth);

  // ===== Night lights (city lights overlay) =====
  const mNight = new THREE.MeshBasicMaterial({
    map: tNight,
    transparent: true,
    blending: THREE.AdditiveBlending,
    opacity: 0.9
  });
  const earthNight = new THREE.Mesh(gEarth, mNight);
  scene.add(earthNight);

  // ===== Clouds =====
  const gCloud = new THREE.SphereGeometry(5.05, 128, 128);
  const mCloud = new THREE.MeshLambertMaterial({
    map: tCloud,
    transparent: true,
    opacity: 0.42,
    depthWrite: false
  });
  const clouds = new THREE.Mesh(gCloud, mCloud);
  scene.add(clouds);

  // ===== Atmosphere Glow (simple rim) =====
  const gAtmo = new THREE.SphereGeometry(5.2, 128, 128);
  const mAtmo = new THREE.MeshBasicMaterial({
    color: 0x3388ff,
    transparent: true,
    opacity: 0.22,
    side: THREE.BackSide,
    blending: THREE.AdditiveBlending
  });
  const atmosphere = new THREE.Mesh(gAtmo, mAtmo);
  scene.add(atmosphere);

  // ===== Twinkling Stars (dua lapis untuk kedalaman & "kelap-kelip") =====
  function makeStars(count, size, spread){
    const geo = new THREE.BufferGeometry();
    const pos = new Float32Array(count*3);
    for(let i=0;i<count;i++){
      pos[i*3+0] = (Math.random()-0.5)*spread;
      pos[i*3+1] = (Math.random()-0.5)*spread;
      pos[i*3+2] = (Math.random()-0.5)*spread;
    }
    geo.setAttribute('position', new THREE.BufferAttribute(pos,3));
    const mat = new THREE.PointsMaterial({ size, color: 0xffffff, transparent:true, opacity: 0.8, depthWrite:false });
    return new THREE.Points(geo, mat);
  }
  const starsNear = makeStars(6000, 0.7, 1800);
  const starsFar  = makeStars(10000, 0.5, 2600);
  scene.add(starsNear, starsFar);

  // ===== Small helpers (slow rotations) =====
  let t = 0;
  function animate(){
    requestAnimationFrame(animate);

    // Rotasi & dinamika
    earth.rotation.y      += 0.0008;
    earthNight.rotation.y += 0.0008;
    clouds.rotation.y     += 0.001;

    // Twinkle subtle (layer berbeda fase)
    t += 0.01;
    starsNear.material.opacity = 0.7 + Math.sin(t*1.7)*0.08;
    starsFar.material.opacity  = 0.7 + Math.cos(t*1.2)*0.06;

    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  // Resize
  addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });
  </script>
</body>
</html>