<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Portofolio Alokasi Cake Interaktif</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      background: #f7f8fa;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    h2 {
      margin-top: 2em;
      margin-bottom: 0.5em;
      font-weight: 600;
      color: #333;
    }
    #chart {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 80vh;
    }
    .tooltip {
      position: absolute;
      background: #fff;
      border: 1px solid #bbb;
      padding: 10px 16px;
      border-radius: 8px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.15);
      pointer-events: none;
      font-size: 15px;
      color: #333;
      opacity: 0;
      transition: opacity 0.18s;
      z-index: 10;
    }
    .slice {
      cursor: pointer;
      transition: filter 0.18s, stroke-width 0.18s;
    }
    .slice:hover {
      filter: brightness(1.16) drop-shadow(0 0 8px #ffb300);
      stroke: #333;
      stroke-width: 3px;
    }
    .label {
      font-weight: 500;
      font-size: 14px;
      fill: #444;
      pointer-events: none;
      text-shadow: 0 1px 4px #fff, 0 2px 8px #eee;
    }
    .center-label {
      font-size: 22px;
      fill: #666;
      text-anchor: middle;
      font-weight: 600;
      pointer-events: none;
    }
    @media (max-width: 600px) {
      #chart svg { width: 98vw !important; height: 98vw !important; }
    }
  </style>
</head>
<body>
  <h2>Portofolio Alokasi Cake Interaktif</h2>
  <div id="chart"></div>
  <div class="tooltip" id="tooltip"></div>

  <script>
  // --- DATA PORTOFOLIO ---
  // Ganti data di bawah sesuai kebutuhan
  const data = [
    { name: "Tech Stocks", value: 30 },
    { name: "Crypto", value: 50 },
    { name: "Gold", value: 80 },
    { name: "Cash", value: 45 },
    { name: "Property", value: 70 },
    { name: "Startup", value: 55 }
  ];

  // --- UKURAN CHART ---
  const width = 520, height = 520, innerRadius = 80, maxRadius = 210;
  const gap = 0.07; // radian gap antar slice

  // --- SKALA RADIUS ---
  const radiusScale = d3.scaleLinear()
    .domain([0, d3.max(data, d => d.value)])
    .range([innerRadius, maxRadius]);

  // --- PIE GENERATOR (slice sama rata, tapi radius beda) ---
  const pie = d3.pie()
    .value(d => 1)
    .sort(null);

  const arcs = pie(data);

  // --- ARC GENERATOR ---
  function arcGen(d, i) {
    return d3.arc()
      .innerRadius(innerRadius)
      .outerRadius(radiusScale(data[i].value))
      .padAngle(gap)
      .cornerRadius(12)(d);
  }

  // --- SVG ---
  const svg = d3.select("#chart").append("svg")
    .attr("width", width)
    .attr("height", height);

  const g = svg.append("g")
    .attr("transform", `translate(${width/2},${height/2})`);

  // --- WARNA PALETTE ---
  const colors = d3.schemeSet2.concat(d3.schemeSet1);

  // --- DRAW SLICES + ANIMASI ENTRANCE ---
  g.selectAll("path")
    .data(arcs)
    .enter().append("path")
      .attr("class", "slice")
      .attr("fill", (d, i) => colors[i % colors.length])
      .attr("d", d => d3.arc()
        .innerRadius(innerRadius)
        .outerRadius(innerRadius)
        .padAngle(gap)
        .cornerRadius(12)(d)
      )
      .each(function(d, i) { this._current = d; })
      .transition()
      .duration(1100)
      .attrTween("d", function(d, i) {
        const interpolate = d3.interpolate(innerRadius, radiusScale(data[i].value));
        return function(t) {
          return d3.arc()
            .innerRadius(innerRadius)
            .outerRadius(interpolate(t))
            .padAngle(gap)
            .cornerRadius(12)(d);
        };
      });

  // --- LABELS (NAMA ALLOKASI) ---
  g.selectAll(".label")
    .data(arcs)
    .enter().append("text")
      .attr("class", "label")
      .attr("transform", function(d, i) {
        const r = radiusScale(data[i].value) + 18;
        const angle = (d.startAngle + d.endAngle) / 2 - Math.PI/2;
        const x = Math.cos(angle) * r;
        const y = Math.sin(angle) * r;
        return `translate(${x},${y})`;
      })
      .attr("text-anchor", "middle")
      .attr("alignment-baseline", "middle")
      .text(d => d.data.name);

  // --- CENTER LABEL (TOTAL) ---
  const total = d3.sum(data, d => d.value);
  g.append("text")
    .attr("class", "center-label")
    .attr("y", 12)
    .text(`Total: ${total}`);

  // --- TOOLTIP LOGIC ---
  const tooltip = d3.select("#tooltip");
  g.selectAll(".slice")
    .on("mousemove", function(event, d) {
      tooltip
        .style("opacity", 1)
        .html(`<b>${d.data.name}</b><br>Alokasi: <span style="color:#1976d2;font-weight:600;">${d.data.value}</span>`)
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY - 30) + "px");
    })
    .on("mouseleave", function() {
      tooltip.style("opacity", 0);
    });

  // --- ANIMASI INTERAKTIF (EXPLODE) ---
  g.selectAll(".slice")
    .on("click", function(event, d) {
      const midAngle = (d.startAngle + d.endAngle) / 2 - Math.PI/2;
      const xOff = Math.cos(midAngle) * 36;
      const yOff = Math.sin(midAngle) * 36;
      d3.select(this)
        .transition()
        .duration(340)
        .attr("transform", `translate(${xOff},${yOff})`)
        .transition()
        .duration(340)
        .attr("transform", `translate(0,0)`);
    });

  </script>
</body>
</html>