<!DOCTYPE html>
<html>
<head>
  <title>Portfolio Alokasi Cake</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .slice {
      cursor: pointer;
      transition: filter 0.2s;
    }
    .slice:hover {
      filter: brightness(1.2);
      stroke: #333;
      stroke-width: 2px;
    }
    .tooltip {
      position: absolute;
      background: white;
      border: 1px solid #aaa;
      padding: 8px;
      border-radius: 5px;
      pointer-events: none;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>
<div id="chart"></div>
<script>
// Data contoh
const data = [
  { name: "Cake A", value: 30 },
  { name: "Cake B", value: 50 },
  { name: "Cake C", value: 80 },
  { name: "Cake D", value: 45 },
  { name: "Cake E", value: 70 }
];

// Ukuran chart
const width = 500, height = 500, innerRadius = 80, maxRadius = 200;
const gap = 0.07; // gap antar slice (radian)

// Skala radius
const radiusScale = d3.scaleLinear()
  .domain([0, d3.max(data, d => d.value)])
  .range([innerRadius, maxRadius]);

// Pie generator
const pie = d3.pie()
  .value(d => 1) // slice sama rata
  .sort(null);

// Arc generator custom
const arcs = pie(data);

const arcGen = d3.arc()
  .innerRadius(innerRadius)
  .outerRadius((d, i) => radiusScale(data[i].value))
  .padAngle(gap)
  .cornerRadius(8);

const svg = d3.select("#chart").append("svg")
  .attr("width", width)
  .attr("height", height);

const g = svg.append("g")
  .attr("transform", `translate(${width/2},${height/2})`);

// Animasi masuk
g.selectAll("path")
  .data(arcs)
  .enter().append("path")
    .attr("class", "slice")
    .attr("fill", (d, i) => d3.schemeCategory10[i % 10])
    .attr("d", d => arcGen({ ...d, outerRadius: innerRadius }))
    .transition()
    .duration(1200)
    .attrTween("d", function(d, i) {
      const interpolate = d3.interpolate(innerRadius, radiusScale(data[i].value));
      return function(t) {
        return arcGen({ ...d, outerRadius: interpolate(t) });
      };
    });

// Tooltip
const tooltip = d3.select("body").append("div").attr("class", "tooltip").style("opacity", 0);

g.selectAll("path")
  .on("mouseover", function(event, d) {
    d3.select(this).attr("fill", "#ff9800");
    tooltip.transition().duration(200).style("opacity", 1);
    tooltip.html(`<strong>${d.data.name}</strong><br/>Alokasi: ${d.data.value}`)
      .style("left", (event.pageX + 10) + "px")
      .style("top", (event.pageY - 20) + "px");
  })
  .on("mouseout", function(event, d, i) {
    d3.select(this).attr("fill", d3.schemeCategory10[i % 10]);
    tooltip.transition().duration(200).style("opacity", 0);
  });

// Interaktif: klik slice -> explode efek
g.selectAll("path")
  .on("click", function(event, d) {
    const midAngle = (d.startAngle + d.endAngle) / 2;
    const xOff = Math.cos(midAngle - Math.PI/2) * 30;
    const yOff = Math.sin(midAngle - Math.PI/2) * 30;
    d3.select(this)
      .transition()
      .duration(400)
      .attr("transform", `translate(${xOff},${yOff})`)
      .transition()
      .duration(400)
      .attr("transform", `translate(0,0)`);
  });

</script>
</body>
</html>