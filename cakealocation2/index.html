<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Premium Portfolio Allocation Chart</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      background: linear-gradient(120deg, #f5f7fa 60%, #e3eafc 100%);
      font-family: 'Segoe UI', 'Inter', Arial, sans-serif;
      margin: 0;
      padding: 0;
      color: #222;
    }
    h2 {
      margin-top: 2em;
      margin-bottom: 0.7em;
      font-weight: 700;
      color: #222;
      font-size: 2.1em;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 6px #e3e7ef;
    }
    #chart {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 80vh;
    }
    .tooltip {
      position: absolute;
      background: rgba(255,255,255,0.97);
      border: 1.5px solid #b2b7c6;
      padding: 16px 22px;
      border-radius: 13px;
      box-shadow: 0 4px 28px rgba(60,60,120,0.16);
      pointer-events: none;
      font-size: 16px;
      color: #222;
      opacity: 0;
      transition: opacity 0.17s;
      z-index: 10;
      min-width: 170px;
    }
    .slice {
      cursor: pointer;
      stroke-width: 0;
      filter: drop-shadow(0 2px 12px #b9c6e6a0);
      transition: filter 0.22s, stroke-width 0.22s;
    }
    .slice:hover {
      filter: drop-shadow(0 4px 24px #1976d2c0) brightness(1.15);
      stroke: #1976d2;
      stroke-width: 3px;
    }
    .label-group {
      pointer-events: none;
    }
    .label-bg {
      fill: #fff;
      opacity: 0.82;
      rx: 11px;
      ry: 11px;
      filter: drop-shadow(0 1px 7px #e3e7ef);
    }
    .label-code {
      font-weight: 700;
      font-size: 17px;
      fill: #1976d2;
      letter-spacing: 0.2px;
    }
    .label-percent {
      font-size: 15px;
      fill: #222;
      font-weight: 500;
      letter-spacing: 0.09px;
    }
    @media (max-width: 600px) {
      #chart svg { width: 98vw !important; height: 98vw !important; }
      .label-code { font-size: 13px; }
      .label-percent { font-size: 11px; }
    }
  </style>
</head>
<body>
  <h2>Portfolio Allocation</h2>
  <div id="chart"></div>
  <div class="tooltip" id="tooltip"></div>
  <script>
  // --- DATA: asset code, value ---
  // value in USD (change as needed)
  const data = [
    { code: "AAPL", value: 34000 },      // Apple Stock
    { code: "BTC", value: 22000 },       // Bitcoin
    { code: "GLD", value: 42000 },       // Gold
    { code: "USD", value: 18000 },       // Cash
    { code: "PROP", value: 36000 },      // Property
    { code: "START", value: 26000 }      // Startup
  ];

  // --- CONFIG ---
  const width = 650, height = 650, innerRadius = 90, maxRadius = 230;
  const gap = 0.08; // radian gap slice
  const pad = 21; // for label background

  // --- COLOR GRADIENTS ---
  const gradients = [
    ["#1976d2", "#64b5f6"],
    ["#ff9800", "#ffd600"],
    ["#8e24aa", "#ce93d8"],
    ["#43a047", "#a5d6a7"],
    ["#ef5350", "#ffb3b3"],
    ["#00897b", "#80cbc4"]
  ];

  // --- CALCULATE PERCENTAGES ---
  const total = data.reduce((acc, d) => acc + d.value, 0);
  data.forEach(d => d.percent = d.value / total * 100);

  // --- SCALES ---
  const radiusScale = d3.scaleLinear()
    .domain([0, d3.max(data, d => d.value)])
    .range([innerRadius, maxRadius]);

  // --- PIE ---
  const pie = d3.pie()
    .value(d => 1) // slice sama rata, radius beda
    .sort(null);

  const arcs = pie(data);

  // --- SVG ---
  const svg = d3.select("#chart").append("svg")
    .attr("width", width)
    .attr("height", height);

  const g = svg.append("g")
    .attr("transform", `translate(${width/2},${height/2})`);

  // --- GRADIENT DEFINITIONS ---
  const defs = svg.append("defs");
  gradients.forEach((grad, i) => {
    const id = `grad${i}`;
    const linear = defs.append("linearGradient")
      .attr("id", id)
      .attr("x1", "0%").attr("y1", "0%")
      .attr("x2", "100%").attr("y2", "100%");
    linear.append("stop").attr("offset", "0%").attr("stop-color", grad[0]);
    linear.append("stop").attr("offset", "100%").attr("stop-color", grad[1]);
  });

  // --- ARC GENERATOR ---
  function arcGen(d, i, outerR = null) {
    return d3.arc()
      .innerRadius(innerRadius)
      .outerRadius(outerR || radiusScale(data[i].value))
      .padAngle(gap)
      .cornerRadius(18)(d);
  }

  // --- ANIMASI ENTRANCE: CHART ROTATES IN ---
  g.attr("transform", `translate(${width/2},${height/2}) rotate(-120)`);
  setTimeout(() => {
    g.transition()
      .duration(1200)
      .attr("transform", `translate(${width/2},${height/2}) rotate(0)`);
  }, 80);

  // --- DRAW SLICES ---
  g.selectAll("path")
    .data(arcs)
    .enter().append("path")
      .attr("class", "slice")
      .attr("fill", (d, i) => `url(#grad${i})`)
      .attr("d", d => arcGen(d, d.index, innerRadius))
      .each(function(d, i) { this._current = d; })
      .transition()
      .duration(1200)
      .attrTween("d", function(d, i) {
        const interpolate = d3.interpolate(innerRadius, radiusScale(data[i].value));
        return function(t) { return arcGen(d, i, interpolate(t)); };
      });

  // --- LABELS: CODE & PERCENT (INSIDE SLICE) ---
  const labelGroups = g.selectAll(".label-group")
    .data(arcs)
    .enter().append("g")
    .attr("class", "label-group")
    .attr("transform", function(d, i) {
      const r = radiusScale(data[i].value) + pad;
      const angle = (d.startAngle + d.endAngle) / 2 - Math.PI/2;
      const x = Math.cos(angle) * r;
      const y = Math.sin(angle) * r;
      return `translate(${x},${y})`;
    });

  // --- LABEL BG RECT ---
  labelGroups.append("rect")
    .attr("class", "label-bg")
    .attr("x", -50)
    .attr("y", -24)
    .attr("width", 100)
    .attr("height", 48);

  // --- ASSET CODE ---
  labelGroups.append("text")
    .attr("class", "label-code")
    .attr("x", 0)
    .attr("y", -3)
    .attr("text-anchor", "middle")
    .text(d => d.data.code);

  // --- PERCENTAGE ---
  labelGroups.append("text")
    .attr("class", "label-percent")
    .attr("x", 0)
    .attr("y", 15)
    .attr("text-anchor", "middle")
    .text(d => `${d.data.percent.toFixed(1)}%`);

  // --- TOOLTIP LOGIC ---
  function formatUSD(num) {
    return "$" + num.toLocaleString('en-US');
  }
  const tooltip = d3.select("#tooltip");
  g.selectAll(".slice")
    .on("mousemove", function(event, d) {
      const i = d.index;
      d3.select(this)
        .transition()
        .duration(180)
        .attr("filter", "drop-shadow(0 4px 32px #1976d2b0) brightness(1.22)")
        .attr("d", arcGen(d, i, radiusScale(data[i].value) + 18));
      tooltip
        .style("opacity", 1)
        .html(`
          <div style="font-weight:700;font-size:18px;color:${gradients[i][0]};">${d.data.code}</div>
          <div style="margin-top:8px;font-size:16px;">
            <b>${d.data.percent.toFixed(2)}%</b> &mdash; <span style="color:#8e24aa">${formatUSD(d.data.value)}</span>
          </div>
        `)
        .style("left", (event.pageX + 18) + "px")
        .style("top", (event.pageY - 40) + "px");
    })
    .on("mouseleave", function(event, d) {
      const i = d.index;
      d3.select(this)
        .transition()
        .duration(240)
        .attr("filter", "drop-shadow(0 2px 12px #b9c6e6a0)")
        .attr("d", arcGen(d, i));
      tooltip.style("opacity", 0);
    })
    .on("click", function(event, d) {
      const i = d.index;
      const midAngle = (d.startAngle + d.endAngle) / 2 - Math.PI/2;
      const xOff = Math.cos(midAngle) * 28;
      const yOff = Math.sin(midAngle) * 28;
      d3.select(this)
        .transition().duration(320)
        .attr("transform", `translate(${xOff},${yOff})`)
        .transition().duration(320)
        .attr("transform", `translate(0,0)`);
    });

  // --- RESPONSIVE ---
  function responsive() {
    const size = Math.min(window.innerWidth, 650);
    svg.attr("width", size).attr("height", size);
    g.attr("transform", `translate(${size/2},${size/2})`);
  }
  window.addEventListener('resize', responsive);
  responsive();

  </script>
</body>
</html>